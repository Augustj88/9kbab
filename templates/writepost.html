<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{{url_for('static', filename='css/writepost.css')}}">
    <title>Title</title>

    <script>
        function doPost(){
            const form = $('#file_form')[0];
            let formData = new FormData(form);
            const post_photo = $('#post-photo')[0].files[0];
            const post_writing = $('#post-writing').val();
            const post_tag = $('#post-tag').val();
            const post_location = $('#post-location').val();

            formData.append('photo_give', post_photo);
            formData.append('writing_give', post_writing)
            formData.append('tag_give', post_tag)
            formData.append('location_give', post_location)

            $.ajax({
                type: 'POST',
                url: '/api/writepost',
                processData: false,
                contentType: false,
                data: formData,
                success: function (response) {
                    if (response['result'] == 'success') {
                        alert(response['msg'])
                        window.location.href = '/'
                    } else {
                        alert(response['msg'])
                        window.location.reload()
                    }
                },
                error: function (err) {
                    console.log('error:' + err)
                }
            })
        }
        function doCancel() {
            window.location.href = '/'
        }

        function setThumbnail(event) {
            if (document.querySelector("div#photo-preview img") != null) {
                $(".preview").remove();
            }

            let reader = new FileReader();
            reader.onload = function (event) {
                let img = document.createElement("img");
                img.setAttribute("src", event.target.result);
                img.setAttribute("class", "preview");
                document.querySelector("div#photo-preview").appendChild(img);
            };
            reader.readAsDataURL(event.target.files[0]);
        }
    </script>
    <style>
        #photo-preview {
            background-color: yellow;
            width: 100%;
        }

        #photo-preview > img {
            width:100%;
            border: 3px solid rgb(199, 206, 212);
        }
    </style>
</head>
<body>
    <div id="main">
        <div id="header">
            <img id="logo" src="../static/images/9kbob_v01.png"/>
            <h1>새 글</h1>
        </div>
        <div id="container">
            <form id="file_form" method="post" enctype="multipart/form-data" action="">
                <div class="mb-3">
                    <div id="photo-preview"></div>
                    <div class="mb-3">
                        <label for="post-photo" class="form-label">사진 올리기</label>
                        <input class="form-control" type="file" id="post-photo" accept="image/*"
                               onchange="setThumbnail(event);">
                    </div>
                </div>
                <div class="mb-3">
                    <label for="post-writing" class="form-label">글 작성하기</label>
                    <textarea class="form-control" id="post-writing" rows="3"></textarea>
                </div>
                <div class="mb-3">
                    <label for="post-tag" class="form-label">태그 작성하기</label>
                    <input type="text" class="form-control" id="post-tag" placeholder="#맛집">
                </div>
                <div class="mb-3">
                    <label for="post-location" class="form-label">장소 등록하기</label>
                    <input type="text" class="form-control" id="post-location">
                </div>
                <div id="buttons">
                    <button type="button" class="btn btn-primary" onclick="doPost()">등록하기</button>
                    <button type="button" class="btn btn-secondary" onclick="doCancel()">취소하기</button>
                </div>
            </form>
        </div>
    </div>
    </body>
</html>